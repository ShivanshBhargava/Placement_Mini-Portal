generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Student {
  id           Int           @id @default(autoincrement())
  name         String
  email        String        @unique
  password     String
  age          Int?
  branch       String?
  year         Int?
  cgpa         Float?
  percentage   Float?
  college      String?
  university   String?
  passingYear  Int?
  bio          String?
  goals        String?
  profileImage String?
  resumeUrl    String?
  resumeName   String?
  createdAt    DateTime      @default(now())
  applications Application[] @relation("StudentApplications")
  attendance   Attendance[]

  @@map("students")
}

model Company {
  id          Int      @id @default(autoincrement())
  companyName String
  email       String   @unique
  password    String
  createdAt   DateTime @default(now())
  jobs        Job[]    @relation("CompanyJobs")

  @@map("company")
}

model Job {
  id            Int           @id @default(autoincrement())
  title         String
  companyName   String
  description   String?
  eligibility   String?
  location      String?
  salaryPackage String?
  postedAt      DateTime      @default(now())
  postedById    Int
  applications  Application[] @relation("JobApplications")
  postedBy      Company       @relation("CompanyJobs", fields: [postedById], references: [id])

  @@index([postedById])
  @@map("jobs")
}

model Application {
  id        Int               @id @default(autoincrement())
  studentId Int
  jobId     Int
  appliedAt DateTime          @default(now())
  status    ApplicationStatus @default(PENDING)
  job       Job               @relation("JobApplications", fields: [jobId], references: [id], onDelete: Cascade)
  student   Student           @relation("StudentApplications", fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, jobId])
  @@index([jobId])
  @@map("applications")
}

enum ApplicationStatus {
  PENDING
  SHORTLISTED
  SELECTED
  REJECTED
}

model Subject {
  id          Int          @id @default(autoincrement())
  name        String
  code        String?
  credits     Int?
  attendances Attendance[]
  @@map("subjects")
}

model Attendance {
  id        Int     @id @default(autoincrement())
  studentId Int
  subjectId Int
  total     Int     @default(0)
  attended  Int     @default(0)
  student   Student @relation(fields: [studentId], references: [id])
  subject   Subject @relation(fields: [subjectId], references: [id])

  @@unique([studentId, subjectId])
  @@map("attendance")
}
